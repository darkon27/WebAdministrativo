@model GarantiaViewModels
@{
    ViewBag.Title = "Nuevo";
}
<script src="~/Content/assets/vendor/jquery-validation/jquery.validate.js"></script>
<script src="~/Content/assets/vendor/jquery-validation/jquery.validate.min.js"></script>

<div class="panel-body">
    @if (TempData["Message"] != null)
    {
        <div class="alert alert-@TempData["MessageType"]">
            @TempData["Message"]
        </div>
    }
    @using (Html.BeginForm("Guardar", "Garantia", FormMethod.Post, new { @id = "garantiaForm" }))
    {
        <h2>
            Nueva Garantia
        </h2>
        <div class="row">
            <ul class="notifications" style="float:right">
                <li>
                    <button type="submit" class="btn btn-primary">
                        <i class="fa fa-save"></i>
                    </button>
                </li>
                <li>
                    <a href="@Url.Action("Index","Garantia")" class="btn btn-primary">
                        <i class="fa fa-mail-reply "></i>
                    </a>
                </li>
            </ul>
        </div>
        <div class="row">
            <div class="col-sm-3">
                <div class="form-group">
                    <label class=" control-label">Fecha Registro</label>
                    <div class="input-group">
                        <span class="input-group-addon">
                            <i class="fa fa-calendar"></i>
                        </span>
                        <input type="text" id="Garantia.FECHAREGISTRO" placeholder="__/__/____" data-plugin-datepicker data-plugin-options='{"format": "dd/mm/yyyy"}'
                               class="form-control" value="@ViewBag.FechaRegistro">
                    </div>
                </div>
            </div>
            <div class="col-sm-9">
                <div class="form-group">
                    <label class="control-label">Contacto</label>
                    <div class="input-group">
                        <span class="input-group-addon">
                            <i class="fa fa-user"></i>
                        </span>
                        <input type="text" name="Garantia.CONTACTO" class="spinner-input form-control" value="@ViewBag.UserNameAdmin">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-3">
                <div class="form-group">
                    <label class="control-label">Ruc</label>
                    <div class="input-group">
                        <input type="text" id="rucInput" class="spinner-input form-control">
                        <span class="input-group-addon">
                            <a title="Buscar Ruc" href="#" onclick="BuscarRuc(); return false;"><i class="fa fa-search"></i></a>
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-sm-2">
                <div class="form-group">
                    <div hidden>
                        <label class="control-label">ID Empresa</label>
                        @Html.TextBoxFor(m => m.Garantia.IDEMPRESA, new { @class = "form-control" })
                    </div>
                </div>
            </div>
            <div class="col-sm-9">
                <div class="form-group">
                    <label class="control-label">Empresa</label>
                    <div class="input-group">
                        <span class="input-group-addon">
                            <i class="fa fa-home"></i>
                        </span>
                        @Html.TextBoxFor(m => m.VIEW.EMPRESA, new { @class = "form-control", @oninput = "convertirAMayusculas(this)" })
                        @*@Html.ValidationMessageFor(m => m.VIEW.EMPRESA, "", new { @class = "text-danger" })*@

                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-3">
                <div class="form-group">
                    <label class="control-label">Referencia</label>
                    @Html.TextBoxFor(m => m.Garantia.REFERENCIA, new { @class = "form-control", @required = "required", @oninput = "convertirAMayusculas(this)" })

                </div>
            </div>
            <div class="col-sm-9">
                <div class="form-group">
                    <label class="control-label">Descripcion</label>
                    @Html.TextBoxFor(m => m.Garantia.DESCRIPCION, new { @class = "form-control", @required = "required", @oninput = "convertirAMayusculas(this)" })

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="form-group">
                    <label class="control-label">Observación</label>
                    @Html.TextBoxFor(m => m.Garantia.OBSERVACION, new { @class = "form-control", @required = "required", @oninput = "convertirAMayusculas(this)", @rows = "3" })
                    @*@Html.ValidationMessageFor(m => m.Garantia.OBSERVACION, "", new { @class = "text-danger" })*@
                </div>
            </div>
        </div>
        <br />
        <div class="row">
            <div class="col-sm-2">
                <div class="form-group">
                    <label class="control-label">Item</label>
                    <input type="text" id="txtiTEM" class="spinner-input form-control">
                </div>
            </div>
            <div class="col-sm-7">
                <div class="form-group">
                    <label class="control-label">Descripcion</label>
                    <input type="text" id="txtDESCRIPCION" class="spinner-input form-control">
                </div>
            </div>
            <div class="col-sm-2">
                <div class="form-group">
                    <label class="control-label">Cantidad</label>
                    <input type="text" id="txtCANTIDAD" class="spinner-input form-control">
                </div>
            </div>
            <div class="col-sm-1">
                <br />
                <div class="form-group">
                    <label class="control-label"></label>
                    <a title="Agregar" class="btn btn-default spinner-up" href="#" onclick="AgregarConcepto(); return false;"><i class="fa fa-plus-square"></i></a>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="panel-body" id="divConceptos">
                <table id="tablaConceptos" class="table table-bordered table-striped table-condensed mb-none">

                    <tr>
                        <th>Nro</th>
                        <th>Item</th>
                        <th>Descripcion</th>
                        <th>Cantidad</th>
                        <th>Marca</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>

                </table>
            </div>
        </div>
    }
</div>
<footer class="panel-footer">
</footer>



<div id="modalAnular" class="modal-block modal-block-md mfp-hide">
    <section class="panel">
        <header class="panel-heading">
            <h2 class="panel-title">Confirmación</h2>
        </header>
        <div class="panel-body">
            <div class="modal-wrapper">
                <div class="modal-text">
                    <p>Esta seguro de Quitar el Producto?</p>
                </div>
            </div>
        </div>
        <footer class="panel-footer">
            <div class="row">
                <div class="col-md-12 text-right">
                    <button class="btn btn-primary modal-confirm" onclick="modalAnular()">Si Estoy seguro</button>
                    <button class="btn btn-default modal-dismiss">Cancel</button>
                </div>
            </div>
        </footer>
    </section>
</div>

<div id="modalAgregar" class="modal-block modal-block-md mfp-hide">
    <section class="panel">
        <header class="panel-heading">
            <h2 class="panel-title">Confirmación</h2>
        </header>
        <div class="panel-body">
            <div class="modal-wrapper">
                <div class="modal-text">
                    <p>Esta seguro de Agregar el Producto?</p>
                </div>
            </div>
        </div>
        <footer class="panel-footer">
            <div class="row">
                <div class="col-md-12 text-right">
                    <button class="btn btn-primary modal-confirm" onclick="modalAnular()">Si Estoy seguro</button>
                    <button class="btn btn-default modal-dismiss">Cancel</button>
                </div>
            </div>
        </footer>
    </section>
</div>

<script>
    document.getElementById('txtCANTIDAD').addEventListener('input', function (e) {
        var value = e.target.value;
        e.target.value = value.replace(/[^0-9]/g, '');
    });

    document.getElementById('rucInput').addEventListener('input', function (e) {
        var value = e.target.value;
        e.target.value = value.replace(/[^0-9]/g, '');
    });
</script>

<script>
function BuscarRuc() {
    var ruc = document.getElementById("rucInput").value;
    if (ruc) {
        $.ajax({
            url: '@Url.Action("BuscarEmpresaPorRuc", "Garantia")',
            type: 'GET',
            data: { ruc: ruc },
            success: function (response) {
                if (response.success) {
                    document.getElementById("Garantia_IDEMPRESA").value = response.idEmpresa;
                    document.getElementById("VIEW_EMPRESA").value = response.nombreEmpresa;
                } else {
                    alert(response.message);
                }
            },
            error: function () {
                alert("Error al buscar la empresa. Inténtelo de nuevo.");
            }
        });
    } else {
        alert("Por favor ingrese un RUC.");
    }
}
</script>

<script>
    var num = 0;
    function AgregarConcepto() {

      //  console.log("hola");
        let Cantidad = document.getElementById("txtCANTIDAD").value;
        let Item = document.getElementById("txtiTEM").value;
        let Descripcion = document.getElementById("txtDESCRIPCION").value;

        let Tabla = document.getElementById("tablaConceptos");
        let TR = document.createElement("tr");
        let TDID = document.createElement("td");
        let TDItem = document.createElement("td");
        let TDDescripcion = document.createElement("td");
        let TDCantidad = document.createElement("td");
        let TDMarca = document.createElement("td");
        let TDDesEstado = document.createElement("td");

        TR.appendChild(TDID);
        TR.appendChild(TDItem);
        TR.appendChild(TDDescripcion);
        TR.appendChild(TDCantidad);
        TR.appendChild(TDMarca);
        TR.appendChild(TDDesEstado);

        TDItem.innerHTML = Item;
        TDDescripcion.innerHTML = Descripcion;
        TDCantidad.innerHTML = Cantidad;

        Tabla.appendChild(TR);

        let DivConceptos = document.getElementById("divConceptos");
        let HiddenIndex = document.createElement("input");
        let HiddenCantidad = document.createElement("input");
        let HiddenItem = document.createElement("input");
        let HiddenDescripcion = document.createElement("input");

        HiddenIndex.name = "ListaDetalle.Index";
        HiddenIndex.value = num;
        HiddenIndex.type = "hidden";

        HiddenCantidad.name = "ListaDetalle["+ num +"].CANTIDAD";
        HiddenCantidad.value = Cantidad;
        HiddenCantidad.type = "hidden";

        HiddenItem.name = "ListaDetalle[" + num + "].ITEM";
        HiddenItem.value = Item;
        HiddenItem.type = "hidden";

        HiddenDescripcion.name = "ListaDetalle[" + num + "].DESCRIPCION";
        HiddenDescripcion.value = Descripcion;
        HiddenDescripcion.type = "hidden";

        DivConceptos.appendChild(HiddenIndex);
        DivConceptos.appendChild(HiddenItem);
        DivConceptos.appendChild(HiddenDescripcion);
        DivConceptos.appendChild(HiddenCantidad);

        document.getElementById("txtCANTIDAD").value="";
        document.getElementById("txtiTEM").value = "";
        document.getElementById("txtDESCRIPCION").value = "";
        num++;
    }


    function getID(id) {
        $("#IDTICKET").val(id);
    }

    function modalAprobar(id) {
        let url= '@Url.Action("UpdAprobarEstado", "Ticket")'
        url = url + '/' + $("#IDTICKET").val();
        window.location.href = url;
    }

</script>
